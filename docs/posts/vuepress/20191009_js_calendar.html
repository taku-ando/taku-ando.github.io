<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jsでカレンダーっぽい配列を作る | web系のメモ</title>
    <meta name="description" content="気になったことや引っかかったところの備忘録的なメモ">
    
    <meta name="keywords" content="javascript calendar">
    <link rel="preload" href="/assets/js/vendor.vue.3f27ff6b.js" as="script"><link rel="preload" href="/assets/css/0.styles.703e0e67.css" as="style"><link rel="preload" href="/assets/js/vendor.commons.703e0e67.js" as="script"><link rel="preload" href="/assets/css/styles.e245ab15.css" as="style"><link rel="preload" href="/assets/js/app.e245ab15.js" as="script"><link rel="preload" href="/assets/css/styles.e245ab15.css" as="style"><link rel="preload" href="/assets/js/2.ea8ddf03.js" as="script"><link rel="prefetch" href="/assets/js/6.2fd590d2.js"><link rel="prefetch" href="/assets/js/1.9bb95a85.js"><link rel="prefetch" href="/assets/js/3.4961feb7.js"><link rel="prefetch" href="/assets/js/4.99ccab56.js"><link rel="prefetch" href="/assets/js/5.718252c6.js"><link rel="prefetch" href="/assets/js/7.ec9e8bbf.js"><link rel="prefetch" href="/assets/js/8.7efd6bb5.js"><link rel="prefetch" href="/assets/js/9.9bf0faec.js"><link rel="prefetch" href="/assets/js/10.a587a44a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.703e0e67.css"><link rel="stylesheet" href="/assets/css/styles.e245ab15.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="app"><header class="header" data-v-1e208b64><div data-v-3e77b1e0 data-v-1e208b64><nav class="navbar" data-v-3e77b1e0><div class="container" data-v-3e77b1e0><a href="/" class="router-link-active" data-v-3e77b1e0><span class="navbar-site-name" data-v-3e77b1e0>
          web系のメモ
        </span></a><div class="navbar-links" data-v-3e77b1e0><a href="/" class="navbar-link" data-v-3e77b1e0>
          Home
        </a><a href="/posts/" class="navbar-link router-link-active" data-v-3e77b1e0>
          Posts
        </a><a href="/about/" class="navbar-link" data-v-3e77b1e0>
          About
        </a></div></div></nav><div class="navbar-holder" style="display:none;" data-v-3e77b1e0></div></div><div class="banner" data-v-5e204581 data-v-1e208b64 data-v-1e208b64><div class="container" data-v-5e204581><div class="center" data-v-5e204581><h1 data-v-5e204581>jsでカレンダーっぽい配列を作る</h1></div></div></div></header><div class="container clearfix show-aside" data-v-6e8afdf7 data-v-6e8afdf7><main class="main" data-v-6e8afdf7><article class="post" data-v-6e8afdf7 data-v-6e8afdf7><section class="post-meta main-div" data-v-0cd84276><section class="post-date clearfix" data-v-0cd84276><span class="create-date" data-v-0cd84276>update at：2019-10-09</span><!----></section><section class="post-links" data-v-0cd84276><a href="/posts/vuepress/20190510_react_storybook.html" class="post-link" data-v-0cd84276>
      前の投稿：storybook v5がうまく動かなかった
    </a><!----></section></section><div class="content custom post-content markdown-body"><h2 id="js-でカレンダーっぽい配列を作る"><a href="#js-でカレンダーっぽい配列を作る" aria-hidden="true" class="header-anchor">#</a> js でカレンダーっぽい配列を作る</h2><p>特に使い道は思いつかないけどスプレッド演算子と Array.prototype の関数もりもりでカレンダーっぽい二次元配列を作る</p><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">calendarArray</span> <span class="token operator">=</span> <span class="token punctuation">(</span>year<span class="token punctuation">,</span> month<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>year<span class="token punctuation">,</span> month <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> firstWeekday <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  date<span class="token punctuation">.</span><span class="token function">setMonth</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span>
  date<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> lastDay <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> lastWeekday <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">const</span> beforeDays <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>firstWeekday<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> days <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">Array</span><span class="token punctuation">(</span>lastDay<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> afterDays <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">-</span> lastWeekday<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>beforeDays<span class="token punctuation">,</span> <span class="token operator">...</span>days<span class="token punctuation">,</span> <span class="token operator">...</span>afterDays<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> day<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> weekNumber <span class="token operator">=</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token number">7</span><span class="token punctuation">)</span>
    acc<span class="token punctuation">[</span>weekNumber<span class="token punctuation">]</span> <span class="token operator">=</span>
      acc<span class="token punctuation">[</span>weekNumber<span class="token punctuation">]</span> <span class="token operator">===</span> undefined <span class="token operator">?</span> <span class="token punctuation">[</span>day<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>acc<span class="token punctuation">[</span>weekNumber<span class="token punctuation">]</span><span class="token punctuation">,</span> day<span class="token punctuation">]</span>
    <span class="token keyword">return</span> acc
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>2019 年 10 月でやった結果はこう
<img src="/assets/img/sc_20191009.png"></p><h2 id="補足"><a href="#補足" aria-hidden="true" class="header-anchor">#</a> 補足</h2><h3 id="月末の最終日を取得する"><a href="#月末の最終日を取得する" aria-hidden="true" class="header-anchor">#</a> 月末の最終日を取得する</h3><div class="language-js extra-class"><pre class="language-js"><code>date<span class="token punctuation">.</span><span class="token function">setMonth</span><span class="token punctuation">(</span>month<span class="token punctuation">)</span>
date<span class="token punctuation">.</span><span class="token function">setDate</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> lastDay <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDate</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> lastWeekday <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getDay</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><p><code>date.setDate(0)</code>で最終日が取れる</p><h3 id="指定数の空文字の配列を生成する"><a href="#指定数の空文字の配列を生成する" aria-hidden="true" class="header-anchor">#</a> 指定数の空文字の配列を生成する</h3><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> beforeDays <span class="token operator">=</span> <span class="token function">Array</span><span class="token punctuation">(</span>firstWeekday<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="指定した数値までの連番の配列を作る"><a href="#指定した数値までの連番の配列を作る" aria-hidden="true" class="header-anchor">#</a> 指定した数値までの連番の配列を作る</h3><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> days <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token function">Array</span><span class="token punctuation">(</span>lastDay<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><p><code>[...Array(lastDay)].map()</code>で月末の日付と同じ数だけ map<br><code>Array(lastDay).map()</code>だとそもそも動かないからスプレッド演算子で展開するの大事！あとは map のコールバックに渡す第二引数のインデックスを返せば連番の配列の出来上がり(1 始まりだから+1)</p><h3 id="_1-週間ごとに配列を分割"><a href="#_1-週間ごとに配列を分割" aria-hidden="true" class="header-anchor">#</a> 1 週間ごとに配列を分割</h3><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token operator">...</span>beforeDays<span class="token punctuation">,</span> <span class="token operator">...</span>days<span class="token punctuation">,</span> <span class="token operator">...</span>afterDays<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>acc<span class="token punctuation">,</span> day<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> weekNumber <span class="token operator">=</span> <span class="token operator">~</span><span class="token operator">~</span><span class="token punctuation">(</span>i <span class="token operator">/</span> <span class="token number">7</span><span class="token punctuation">)</span>
  acc<span class="token punctuation">[</span>weekNumber<span class="token punctuation">]</span> <span class="token operator">=</span>
    acc<span class="token punctuation">[</span>weekNumber<span class="token punctuation">]</span> <span class="token operator">===</span> undefined <span class="token operator">?</span> <span class="token punctuation">[</span>day<span class="token punctuation">]</span> <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token operator">...</span>acc<span class="token punctuation">[</span>weekNumber<span class="token punctuation">]</span><span class="token punctuation">,</span> day<span class="token punctuation">]</span>
  <span class="token keyword">return</span> acc
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre></div><ul><li><code>[...beforeDays, ...days, ...afterDays]</code>で配列を結合</li><li><code>const weekNumber = ~~(i / 7)</code>で週の番号を取得
<ul><li><code>~~</code>で小数点以下は切り捨て</li></ul></li></ul><h2 id="おわり"><a href="#おわり" aria-hidden="true" class="header-anchor">#</a> おわり</h2></div><section class="post-meta main-div" data-v-69565267><div id="disqus_thread" data-v-69565267></div></section><section class="post-meta main-div" data-v-0cd84276><section class="post-date clearfix" data-v-0cd84276><span class="create-date" data-v-0cd84276>update at：2019-10-09</span><!----></section><section class="post-links" data-v-0cd84276><a href="/posts/vuepress/20190510_react_storybook.html" class="post-link" data-v-0cd84276>
      前の投稿：storybook v5がうまく動かなかった
    </a><!----></section></section></article></main><aside class="aside" data-v-6e8afdf7><div class="info-card main-div" data-v-7323947a data-v-6e8afdf7><div class="info-card-header" style="background-image:null;" data-v-7323947a><img src="/assets/img/user_image.jpg" alt="taku-ando" class="info-avator" data-v-7323947a></div><div class="info-card-body" data-v-7323947a><section class="info-nickname" data-v-7323947a>taku-ando</section><section class="info-desc" data-v-7323947a>だいたい引っかかったところの備忘録的なメモ</section><section class="info-contact" data-v-7323947a><section data-v-7323947a><span title="Fukuoka" class="info info-location" data-v-7323947a><!----><span class="info-text" style="margin-left:0.2rem;">Fukuoka</span></span></section><section data-v-7323947a><!----></section><section data-v-7323947a><!----></section></section></div><div class="info-card-footer" data-v-7323947a><section class="info-sns clearfix" data-v-7323947a><a href="https://github.com/taku-ando" target="_blank" class="sns-link" data-v-7323947a><span title="GitHub: taku-ando" class="sns-icon" data-v-7323947a><!----></span></a></section></div></div></aside></div><footer class="footer" data-v-f283b80c><p class="sns-links" data-v-f283b80c><a href="https://github.com/taku-ando" target="_blank" class="sns-link" data-v-f283b80c><span title="GitHub: taku-ando" class="sns-icon" data-v-f283b80c><!----></span></a></p><p data-v-f283b80c><span data-v-f283b80c>Powered by </span><a href="https://vuepress.vuejs.org" target="_blank" data-v-f283b80c>Vuepress</a></p></footer></div></div>
    <script src="/assets/js/vendor.vue.3f27ff6b.js" defer></script><script src="/assets/js/2.ea8ddf03.js" defer></script><script src="/assets/js/vendor.commons.703e0e67.js" defer></script><script src="/assets/js/app.e245ab15.js" defer></script>
  </body>
</html>
